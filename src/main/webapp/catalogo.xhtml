<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="jakarta.faces.facelets">

    <h:head>
        <title>GRANELIA</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
              rel="stylesheet"/>
        <h:outputStylesheet name="global.css"/>
        <h:outputStylesheet name="catalago.css"/>
    </h:head>

    <h:body class="d-flex flex-column min-vh-100">

        <main class="container my-4 flex-fill">

            <h1 class="h3 mb-4">Productos </h1>

            <h:form id="formProducts" class="mb-3">

                <!-- Barra de acciones -->
                <div class="d-flex flex-wrap gap-2 mb-3">
                    <!-- Cargar / recargar lista -->
                    <h:commandButton value="Cargar productos"
                                     styleClass="btn btn-primary btn-crud"
                                     actionListener="#{products.cargarLista}">
                        <f:ajax render="tabla msgs"/>
                    </h:commandButton>

                    <!-- Agregar nuevo producto (usa el objeto products.nuevo) -->
                    <h:commandButton value="Guardar nuevo"
                                     styleClass="btn btn-success btn-crud"
                                     action="#{products.crearProducto}">
                        <f:ajax execute="@form" render="tabla msgs nuevoProducto"/>
                    </h:commandButton>
                    

                    
                </div>

                <h:messages id="msgs" class="mt-2 text-danger"/>

                <!-- Formulario rápido para nuevo producto -->
                <h:panelGroup id="nuevoProducto" layout="block" styleClass="card mb-3 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Producto</h5>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label small">Nombre</label>
                                <h:inputText value="#{products.nombre}"
                                             styleClass="form-control"/>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label small">Marca</label>
                                <h:inputText value="#{products.marca}"
                                             styleClass="form-control"/>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label small">Categoría</label>
                                <h:inputText value="#{products.cateogoria}"
                                             styleClass="form-control"/>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label small">Peso (g)</label>
                                <h:inputText value="#{products.preso_gramos}"
                                             styleClass="form-control"/>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label small">Precio</label>
                                <h:inputText value="#{products.precio}"
                                             styleClass="form-control"/>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label small">Stock</label>
                                <h:inputText value="#{products.stock}"
                                             styleClass="form-control"/>
                            </div>
                        </div>
                    </div>
                </h:panelGroup>



                <!-- Tabla de productos -->
               <h:panelGroup id="tabla">
    <div class="row row-cols-1 row-cols-md-3 g-4 mt-3">
        <ui:repeat value="#{products.catalogo()}" var="u">

            <div class="col">
                <div class="card h-100 shadow-sm">

                    <!-- Imagen del producto -->
                    <h:graphicImage value="{u.imagenUrl}"
                                    styleClass="card-img-top"
                                    rendered="{not empty u.imagenUrl}" />

                    <!-- Si no hay imagen, puedes mostrar una de relleno -->


                    <div class="card-body">
                        <h5 class="card-title">
                            #{u.nombre}
                        </h5>

                        <p class="card-text mb-2">
                            <span class="badge bg-secondary">
                                #{u.categoria}
                            </span>
                        </p>

                        <ul class="list-unstyled mb-3 small">
                            <li><strong>ID:</strong> #{u.id_producto}</li>
                            <li><strong>Peso:</strong> #{u.peso_gramos} g</li>
                            <li><strong>Precio:</strong> $ #{u.precio}</li>
                            <li><strong>Precio con IVA:</strong> $ #{u.precio_iva}</li>
                            <li><strong>Stock:</strong> #{u.stock}</li>
                        </ul>

                        <div class="d-flex justify-content-end">
                            <!-- Botón Editar -->
                            <h:commandButton value="Editar"
                                             styleClass="btn btn-sm btn-outline-warning me-2"
                                             action="{products.prepararEdicion}">
                                <f:setPropertyActionListener target="#{products.productoActual}"
                                                             value="#{u}"/>
                                <f:ajax render="nuevoProducto msgs"/>
                            </h:commandButton>

                            <!-- Botón Marcar eliminar -->
                            <h:commandButton value="Marcar eliminar"
                                             styleClass="btn btn-sm btn-outline-danger"
                                             action="#{products.marcarEliminar}">
                                <f:setPropertyActionListener target="#{products.productoActual}"
                                                             value="#{u}"/>
                                <f:ajax render="tabla msgs"/>
                            </h:commandButton>
                        </div>
                    </div>
                </div>
            </div>

        </ui:repeat>
    </div>
</h:panelGroup>


            </h:form>
        </main>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    </h:body>
</html>
