<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Historial de Ventas - Cereales</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    /* Encabezado */
    header{
      background:#fde68a; /* amarillo suave */
      height:80px;
      display:flex;align-items:center;justify-content:center;
    }

    /* Tarjetas KPI */
    .kpi{background:#f3f4f6;border-radius:.75rem;padding:1rem;text-align:center}
    .kpi h3{font-size:1.05rem;color:#374151;margin:0 0 .25rem}
    .kpi p{margin:0;font-weight:800;color:#111827}
    .kpi.yellow{background:#fde68a}

    /* Tabla */
    thead th{
      background:#fde68a !important;
      color:#374151;
      text-transform:uppercase;
      font-size:.75rem;
      letter-spacing:.05em;
      font-weight:800;
    }
    tbody tr:hover{background:#f9fafb}

    /* Badges de estado (estilo “pastel”) */
    .badge-status{border:1px solid transparent; padding:.35rem .6rem; font-weight:700}
    .status-entregado{background:#dcfce7;color:#166534;border-color:#bbf7d0}
    .status-transito{background:#dbeafe;color:#1e40af;border-color:#bfdbfe}
    .status-procesando{background:#fef9c3;color:#a16207;border-color:#fde68a}
    .status-pendiente{background:#f3f4f6;color:#374151;border-color:#e5e7eb}

    /* Productos dentro de la celda */
    .prod-name{font-weight:600;color:#111827}
    .prod-sub{color:#6b7280;font-size:.9rem}
  </style>
</head>
<body class="bg-white d-flex flex-column min-vh-100">
  <!-- Header -->
  <header>
    <img src="/logo-encabeza.png" alt="Logo" width="100" height="100" style="object-fit:contain"/>
  </header>

  <main class="flex-grow-1 py-4">
    <div class="container" style="max-width:1200px;">
      <!-- Título -->
      <div class="mb-4">
        <h1 class="h2 fw-bold text-dark mb-2">Historial de Ventas - Cereales</h1>
      </div>

      <!-- KPIs -->
      <div class="row g-3 mb-4">
        <div class="col-12 col-md-3">
          <div class="kpi">
            <h3>Total Pedidos</h3>
            <p id="kpi-total-pedidos">—</p>
          </div>
        </div>
        <div class="col-12 col-md-3">
          <div class="kpi">
            <h3>Entregados</h3>
            <p id="kpi-entregados" class="text-success">—</p>
          </div>
        </div>
        <div class="col-12 col-md-3">
          <div class="kpi">
            <h3>Total Ventas</h3>
            <p id="kpi-total-ventas">—</p>
          </div>
        </div>
        <div class="col-12 col-md-3">
          <div class="kpi yellow">
            <h3>Promedio por Pedido</h3>
            <p id="kpi-promedio">—</p>
          </div>
        </div>
      </div>

      <!-- Filtros -->
      <div class="bg-light rounded-4 p-4 mb-4">
        <div class="row g-3 align-items-end">
          <div class="col-12 col-md">
            <label class="form-label fw-bold text-secondary">Buscar por Cliente o Pedido</label>
            <input id="input-search" type="text" class="form-control" placeholder="Buscar...">
          </div>
          <div class="col-12 col-md-4">
            <label class="form-label fw-bold text-secondary">Filtrar por Estado</label>
            <select id="select-status" class="form-select">
              <option value="all">Todos los Estados</option>
              <option value="Entregado">Entregado</option>
              <option value="En Tránsito">En Tránsito</option>
              <option value="Procesando">Procesando</option>
              <option value="Pendiente">Pendiente</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Tabla -->
      <div class="card shadow-sm border-0 rounded-4">
        <div class="table-responsive">
          <table class="table align-middle mb-0">
            <thead>
              <tr>
                <th class="px-4">Pedido</th>
                <th class="px-4">Cliente</th>
                <th class="px-4">Productos</th>
                <th class="px-4">Fecha Pedido</th>
                <th class="px-4">Total</th>
                <th class="px-4">Estado</th>
              </tr>
            </thead>
            <tbody id="tbody-sales" class="table-group-divider"></tbody>
          </table>
        </div>
        <div id="no-results" class="text-center text-muted py-5 d-none">
          No se encontraron resultados para los filtros aplicados.
        </div>
      </div>
    </div>
  </main>

  <script>
    // ===== Tipos/estado (datos simulados) =====
    const salesData = [
      {
        id:'PED-001', cliente:'ERP',
        productos:[
          { nombre:"Corn Flakes Kellogg's", cantidad:48, precio:89.50 },
          { nombre:'Granola Nature Valley', cantidad:24, precio:125.00 },
          { nombre:'Avena Quaker', cantidad:36, precio:45.75 }
        ],
        fechaPedido:'2024-09-15', fechaEntrega:'2024-09-18',
        status:'Entregado', total:7758.00, metodoPago:'Transferencia'
      },
      {
        id:'PED-002', cliente:'ERP',
        productos:[
          { nombre:'Cheerios General Mills', cantidad:60, precio:95.25 },
          { nombre:"Zucaritas Kellogg's", cantidad:30, precio:78.90 },
          { nombre:'Choco Krispis', cantidad:42, precio:82.15 }
        ],
        fechaPedido:'2024-09-16', fechaEntrega:'2024-09-19',
        status:'En Tránsito', total:11772.30, metodoPago:'Crédito 30 días'
      },
      {
        id:'PED-003', cliente:'ERP',
        productos:[
          { nombre:"Special K Kellogg's", cantidad:18, precio:110.00 },
          { nombre:'Granola con Miel', cantidad:12, precio:135.50 },
          { nombre:'Cereal Fitness', cantidad:24, precio:98.75 }
        ],
        fechaPedido:'2024-09-14', fechaEntrega:'2024-09-17',
        status:'Entregado', total:6270.00, metodoPago:'Efectivo'
      },
      {
        id:'PED-004', cliente:'ERP',
        productos:[
          { nombre:'Trix General Mills', cantidad:36, precio:85.25 },
          { nombre:'Lucky Charms', cantidad:18, precio:120.00 },
          { nombre:'Cocoa Puffs', cantidad:24, precio:92.50 }
        ],
        fechaPedido:'2024-09-17', fechaEntrega:'2024-09-20',
        status:'Procesando', total:7389.00, metodoPago:'Transferencia'
      },
      {
        id:'PED-005', cliente:'ERP',
        productos:[
          { nombre:"Froot Loops Kellogg's", cantidad:30, precio:88.00 },
          { nombre:'Honey Nut Cheerios', cantidad:24, precio:105.75 },
          { nombre:'Raisin Bran', cantidad:18, precio:95.50 }
        ],
        fechaPedido:'2024-09-13', fechaEntrega:'2024-09-16',
        status:'Entregado', total:6459.00, metodoPago:'Crédito 15 días'
      },
      {
        id:'PED-006', cliente:'ERP',
        productos:[
          { nombre:"All-Bran Kellogg's", cantidad:15, precio:115.25 },
          { nombre:'Granola Artesanal', cantidad:20, precio:145.00 },
          { nombre:'Muesli Premium', cantidad:12, precio:165.75 }
        ],
        fechaPedido:'2024-09-18', fechaEntrega:'2024-09-21',
        status:'Pendiente', total:6608.75, metodoPago:'Transferencia'
      }
    ];

    // ===== Utilidades de formato =====
    const fmtMoney = n => '$' + n.toLocaleString('es-MX', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    const statusClass = (s) => ({
      'Entregado':'badge-status status-entregado',
      'En Tránsito':'badge-status status-transito',
      'Procesando':'badge-status status-procesando',
      'Pendiente':'badge-status status-pendiente'
    }[s] || 'badge-status status-pendiente');

    // ===== KPIs (del dataset completo) =====
    (function renderKPIs(){
      const totalPedidos = salesData.length;
      const entregados = salesData.filter(x => x.status === 'Entregado').length;
      const totalVentas = salesData.reduce((a,b)=>a+b.total,0);
      const promedio = totalPedidos ? totalVentas/totalPedidos : 0;

      document.getElementById('kpi-total-pedidos').textContent = totalPedidos;
      document.getElementById('kpi-entregados').textContent = entregados;
      document.getElementById('kpi-total-ventas').textContent = fmtMoney(totalVentas);
      document.getElementById('kpi-promedio').textContent = fmtMoney(promedio);
    })();

    // ===== Render de filas =====
    function renderTable(rows){
      const tbody = document.getElementById('tbody-sales');
      tbody.innerHTML = '';

      if(rows.length === 0){
        document.getElementById('no-results').classList.remove('d-none');
        return;
      }
      document.getElementById('no-results').classList.add('d-none');

      rows.forEach(sale=>{
        const tr = document.createElement('tr');

        // Pedido + método de pago
        const tdPedido = document.createElement('td');
        tdPedido.className = 'px-4';
        tdPedido.innerHTML = `
          <div class="fw-semibold text-dark">${sale.id}</div>
          <div class="text-muted small">${sale.metodoPago}</div>
        `;

        // Cliente + entrega
        const tdCliente = document.createElement('td');
        tdCliente.className = 'px-4';
        tdCliente.innerHTML = `
          <div class="fw-semibold text-dark">${sale.cliente}</div>
          <div class="text-muted small">Entrega: ${sale.fechaEntrega}</div>
        `;

        // Productos
        const tdProd = document.createElement('td');
        tdProd.className = 'px-4';
        tdProd.innerHTML = sale.productos.map(p => `
          <div class="mb-1">
            <div class="prod-name">${p.nombre}</div>
            <div class="prod-sub">Qty: ${p.cantidad} | $${p.precio}</div>
          </div>
        `).join('');

        // Fecha pedido
        const tdFecha = document.createElement('td');
        tdFecha.className = 'px-4';
        tdFecha.textContent = sale.fechaPedido;

        // Total
        const tdTotal = document.createElement('td');
        tdTotal.className = 'px-4';
        tdTotal.innerHTML = `<div class="fw-bold text-dark">${fmtMoney(sale.total)}</div>`;

        // Estado
        const tdStatus = document.createElement('td');
        tdStatus.className = 'px-4';
        tdStatus.innerHTML = `<span class="${statusClass(sale.status)}">${sale.status}</span>`;

        tr.append(tdPedido, tdCliente, tdProd, tdFecha, tdTotal, tdStatus);
        tbody.appendChild(tr);
      });
    }

    // ===== Filtro/búsqueda =====
    const $search = document.getElementById('input-search');
    const $status = document.getElementById('select-status');

    function applyFilters(){
      const term = ($search.value || '').toLowerCase();
      const st = $status.value;

      const filtered = salesData.filter(sale=>{
        const matchesStatus = st === 'all' || sale.status === st;
        const matchesSearch = sale.cliente.toLowerCase().includes(term) || sale.id.toLowerCase().includes(term);
        return matchesStatus && matchesSearch;
      });

      renderTable(filtered);
    }

    $search.addEventListener('input', applyFilters);
    $status.addEventListener('change', applyFilters);

    // Render inicial
    renderTable(salesData);
  </script>
</body>
</html>
