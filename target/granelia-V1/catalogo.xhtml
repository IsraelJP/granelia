<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="jakarta.faces.facelets">

    <h:head>
        <title>GRANELIA - Productos Test</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
              rel="stylesheet"/>
        <h:outputStylesheet name="global.css"/>
        <h:outputStylesheet name="catalago.css"/>
    </h:head>

    <h:body class="d-flex flex-column min-vh-100">

        <main class="container my-4 flex-fill">

            <h1 class="h3 mb-4">Productos (Test)</h1>

            <h:form id="formProducts" class="mb-3">

                <!-- Barra de acciones -->
                <div class="d-flex flex-wrap gap-2 mb-3">
                    <!-- Cargar / recargar lista -->
                    <h:commandButton value="Cargar productos"
                                     styleClass="btn btn-primary btn-crud"
                                     actionListener="#{products.cargarLista}">
                        <f:ajax render="tabla msgs"/>
                    </h:commandButton>

                    <!-- Agregar nuevo producto (usa el objeto products.nuevo) -->
                    <h:commandButton value="Guardar nuevo"
                                     styleClass="btn btn-success btn-crud"
                                     action="#{products.crearProducto}">
                        <f:ajax execute="@form" render="tabla msgs nuevoProducto"/>
                    </h:commandButton>


                    <!-- Actualizar producto seleccionado -->
                    <h:commandButton value="Actualizar seleccionado"
                                     styleClass="btn btn-warning btn-crud"
                                     action="{proaducts.actualizar}">
                        <f:ajax render="tabla msg"/>
                    </h:commandButton>

                    
                </div>

                <h:messages id="msgs" class="mt-2 text-danger"/>

                <!-- Formulario rápido para nuevo producto -->
                <h:panelGroup id="nuevoProducto" layout="block" styleClass="card mb-3 shadow-sm">
                    <div class="card-body">
                        <h5 class="card-title mb-3">Producto</h5>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label small">Nombre</label>
                                <h:inputText value="#{products.nombre}"
                                             styleClass="form-control"/>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label small">Marca</label>
                                <h:inputText value="#{products.marca}"
                                             styleClass="form-control"/>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label small">Categoría</label>
                                <h:inputText value="#{products.cateogoria}"
                                             styleClass="form-control"/>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label small">Peso (g)</label>
                                <h:inputText value="#{products.preso_gramos}"
                                             styleClass="form-control"/>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label small">Precio</label>
                                <h:inputText value="#{products.precio}"
                                             styleClass="form-control"/>
                            </div>

                            <div class="col-md-4">
                                <label class="form-label small">Stock</label>
                                <h:inputText value="#{products.stock}"
                                             styleClass="form-control"/>
                            </div>
                        </div>
                    </div>
                </h:panelGroup>



                <!-- Tabla de productos -->
                <h:panelGroup id="tabla">
                    <table class="table table-striped table-hover mt-3 align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>ID</th>
                                <th>Nombre</th>
                                <th>Categoría</th>
                                <th>Peso (g)</th>
                                <th>Precio</th>
                                <th>Precio con IVA</th>
                                <th>Stock</th>
                                <th class="text-center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <ui:repeat value="#{products.catalogo()}" var="u">
                                <tr>
                                    <td>#{u.id_producto}</td>
                                    <td>#{u.nombre}</td>
                                    <td>#{u.categoria}</td>
                                    <td>#{u.peso_gramos}</td>
                                    <td>$ #{u.precio}</td>
                                    <td>$ #{u.precio_iva}</td>
                                    <td>#{u.stock}</td>
                                    <td class="text-center">
                                        <!-- Seleccionar para edición -->
                                        <h:commandButton value="Editar"
                                                         styleClass="btn btn-sm btn-outline-warning me-1"
                                                         action="{products.prepararEdicion}">
                                            <!-- aquí copiamos u -> productoActual -->
                                            <f:setPropertyActionListener target="#{products.productoActual}"
                                                                         value="#{u}"/>
                                            <f:ajax render="nuevoProducto msgs"/>
                                        </h:commandButton>

                                        <!-- Marcar eliminar (si quieres seleccionar también para eliminar) -->
                                        <h:commandButton value="Marcar eliminar"
                                                         styleClass="btn btn-sm btn-outline-danger"
                                                         action="#{products.marcarEliminar}">
                                            <f:setPropertyActionListener target="#{products.productoActual}" value="#{u}"/>
                                        </h:commandButton>


                                    </td>
                                </tr>
                            </ui:repeat>

                        </tbody>
                    </table>
                </h:panelGroup>

            </h:form>
        </main>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    </h:body>
</html>
